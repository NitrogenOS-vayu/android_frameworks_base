From c404134a18a684f079b2ee9b14b7c92a6b729fe5 Mon Sep 17 00:00:00 2001
From: xyyx <xyyx@mail.ru>
Date: Tue, 3 Nov 2020 17:20:45 +0300
Subject: [PATCH] Battery: Fix led after full charging commit

---
 services/core/java/com/android/server/BatteryService.java | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/services/core/java/com/android/server/BatteryService.java b/services/core/java/com/android/server/BatteryService.java
index 67c27052e228..5a815f6af468 100644
--- a/services/core/java/com/android/server/BatteryService.java
+++ b/services/core/java/com/android/server/BatteryService.java
@@ -1229,7 +1229,7 @@ public final class BatteryService extends SystemService {
             }
             final int level = mHealthInfo.batteryLevel;
             final int status = mHealthInfo.batteryStatus;
-            if (!mLightEnabled || (mIsDndActive && !mAllowBatteryLightOnDnd)) {
+            if (!mLightEnabled || (mIsDndActive && !mAllowBatteryLightOnDnd) || (!mFullBatteryLight && level == 100)) {
                 mBatteryLight.turnOff();
             } else if (level < mLowBatteryWarningLevel) {
                 if (status == BatteryManager.BATTERY_STATUS_CHARGING) {
@@ -1249,9 +1249,6 @@ public final class BatteryService extends SystemService {
                     if (level == 100) {
                         // Battery is really full
                         mBatteryLight.setColor(mBatteryReallyFullARGB);
-                        if (!mFullBatteryLight) {
-                            mBatteryLight.turnOff();
-                        }
                     } else {
                         // Battery is full or charging and nearly full
                         mBatteryLight.setColor(mBatteryFullARGB);
-- 
2.25.1

